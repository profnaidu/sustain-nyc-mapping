<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;SUSTAIN-NYC: Community Sensory Mapping&lt;/title&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Leaflet CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Leaflet Draw CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" /&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Tailwind CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>.observation-marker {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 3px solid white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 8px rgba(0,0,0,0.3);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.sidebar {</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: calc(100vh - 140px);</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow-y: auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.leaflet-popup-content-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 1000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>left: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>top: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(0,0,0,0.5);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal.show {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.drawing-mode {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #fef3c7 !important;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #92400e !important;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Header --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="bg-blue-700 text-white p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1 class="text-2xl font-bold"&gt;SUSTAIN-NYC Community Sensory Mapping&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p class="text-blue-100"&gt;Document environmental experiences • Click map to add observations • Draw transect routes&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Search and Drawing Controls --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mt-3 flex gap-2 flex-wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex-1 min-w-64 relative"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input</p>
<p class="p1"><span class="Apple-converted-space">                    </span>type="text"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>id="searchInput"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>placeholder="Search any location worldwide (e.g., 'South Bronx', 'Hunt's Point Ave, Bronx')"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>class="w-full p-2 pl-8 rounded text-gray-800 text-sm"</p>
<p class="p1"><span class="Apple-converted-space">                </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;svg class="absolute left-2 top-2.5 w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">                </span>onclick="searchLocation()"</p>
<p class="p1"><span class="Apple-converted-space">                </span>class="bg-blue-600 hover:bg-blue-800 px-4 py-2 rounded text-sm"</p>
<p class="p1"><span class="Apple-converted-space">            </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Search</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">                </span>id="drawingModeBtn"</p>
<p class="p1"><span class="Apple-converted-space">                </span>onclick="toggleDrawingMode()"</p>
<p class="p1"><span class="Apple-converted-space">                </span>class="px-4 py-2 rounded text-sm flex items-center bg-blue-600 hover:bg-blue-800 text-white"</p>
<p class="p1"><span class="Apple-converted-space">            </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span id="drawingModeText"&gt;Draw Route&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="flex" style="height: calc(100vh - 140px);"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Sidebar --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="w-80 bg-white shadow-lg sidebar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Instructions --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="instructionsPanel" class="p-4 border-b bg-blue-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 class="font-semibold text-blue-800 mb-2"&gt;📍 Observation Mode&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;ol class="text-sm text-blue-700 space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;🔍 Search for any location worldwide&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;📍 Click anywhere on map to add observations&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;🛣️ Switch to drawing mode for routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;📱 Perfect for mobile fieldwork&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/ol&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Quick Stats --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="p-4 border-b bg-gray-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-2 gap-4 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="observationCount" class="text-2xl font-bold text-blue-600"&gt;2&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="text-xs text-gray-600"&gt;Observations&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="routeCount" class="text-2xl font-bold text-green-600"&gt;0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="text-xs text-gray-600"&gt;Routes&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Categories --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="p-4 border-b"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 class="font-semibold mb-3"&gt;Observation Categories&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-1 gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-red-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Air Pollution&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-purple-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Noise Pollution&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-orange-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Heat/Temperature&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-green-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Green Space&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-gray-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Industrial Activity&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-blue-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Community Asset&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center p-2 rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-4 h-4 rounded mr-2 bg-yellow-600"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;Safety/Health Concern&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Recent Activity --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 class="font-semibold mb-3"&gt;Recent Activity&lt;/h3&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Transect Routes --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="routesList" class="mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4 class="text-sm font-medium text-green-700 mb-2"&gt;Transect Routes&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="routesContainer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-xs text-gray-500 italic"&gt;No routes created yet&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Recent Observations --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4 class="text-sm font-medium text-blue-700 mb-2"&gt;Recent Observations&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="observationsList"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Observations will be populated here --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Main Map Area --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="flex-1 relative"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="map" class="w-full h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Loading indicator --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="mapLoading" class="flex items-center justify-center h-full bg-gray-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-gray-600"&gt;Loading interactive map...&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm text-gray-500 mt-2"&gt;If this takes too long, please refresh the page&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Map Instructions --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="absolute top-4 right-4 bg-white p-3 rounded shadow-lg max-w-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h4 class="font-semibold text-sm mb-2 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="mapInstructionsTitle"&gt;Interactive Map&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;ul class="text-xs text-gray-600 space-y-1" id="mapInstructionsList"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;• Drag to pan, scroll to zoom&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;• Click anywhere to add observation&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;• Use search to find locations&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;li&gt;• Switch to drawing mode for routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Observation Form Modal --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="observationModal" class="modal"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto m-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="p-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex justify-between items-center mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-lg font-semibold"&gt;Add Environmental Observation&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button onclick="closeObservationForm()" class="text-gray-400 hover:text-gray-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;form id="observationForm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;Title *&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="obsTitle" required class="w-full p-2 border rounded text-sm" placeholder="Brief description of what you're observing"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;Category *&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;select id="obsCategory" required class="w-full p-2 border rounded text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value=""&gt;Select category&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="air-pollution"&gt;Air Pollution&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="noise-pollution"&gt;Noise Pollution&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="heat-exposure"&gt;Heat/Temperature&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="green-space"&gt;Green Space&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="industrial"&gt;Industrial Activity&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="community-asset"&gt;Community Asset&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="safety-concern"&gt;Safety/Health Concern&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;Your Name&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="obsObserver" class="w-full p-2 border rounded text-sm" placeholder="Community member, student fellow, etc."&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;Specific Location&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="obsLocation" class="w-full p-2 border rounded text-sm" placeholder="Street address, landmark, etc."&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Sensory Observations --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h4 class="font-medium mb-3 text-green-800"&gt;Sensory Observations&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-sm font-medium mb-1 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;svg class="w-4 h-4 mr-1 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>What do you see?</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;textarea id="obsSee" class="w-full p-2 border rounded text-sm h-20" placeholder="Colors, objects, activities, conditions..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-sm font-medium mb-1 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;svg class="w-4 h-4 mr-1 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>What do you hear?</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;textarea id="obsHear" class="w-full p-2 border rounded text-sm h-20" placeholder="Sounds, noise levels, sources..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-sm font-medium mb-1 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;svg class="w-4 h-4 mr-1 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>What do you smell?</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;textarea id="obsSmell" class="w-full p-2 border rounded text-sm h-20" placeholder="Odors, air quality, pollution..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-sm font-medium mb-1 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;svg class="w-4 h-4 mr-1 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM7 3H5a2 2 0 00-2 2v12a4 4 0 004 4h2a2 2 0 002-2V5a2 2 0 00-2-2H7z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>What do you feel?</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;textarea id="obsFeel" class="w-full p-2 border rounded text-sm h-20" placeholder="Temperature, humidity, textures, physical sensations..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Emotional and Context --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-4 grid grid-cols-1 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;How does this make you feel?&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;textarea id="obsEmotion" class="w-full p-2 border rounded text-sm h-16" placeholder="Emotional response, concerns, thoughts..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1"&gt;Additional Notes&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;textarea id="obsNotes" class="w-full p-2 border rounded text-sm h-16" placeholder="Context, patterns you've noticed, community impact..."&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium mb-1 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>Photo Notes</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="obsPhotoNotes" class="w-full p-2 border rounded text-sm" placeholder="Note about photos you took (attach photos separately)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex justify-end space-x-3 mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button type="button" onclick="closeObservationForm()" class="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>Cancel</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"&gt;&lt;/path&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>Save Observation</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/form&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Leaflet JavaScript --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Leaflet Draw JavaScript --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Global variables</p>
<p class="p1"><span class="Apple-converted-space">        </span>let map;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let drawControl;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let drawnItems;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let observations = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let transectRoutes = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let isDrawingMode = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let selectedLocation = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Sample observations</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sampleObservations = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>{</p>
<p class="p1"><span class="Apple-converted-space">                </span>id: 1,</p>
<p class="p1"><span class="Apple-converted-space">                </span>title: "Diesel Truck Exhaust",</p>
<p class="p1"><span class="Apple-converted-space">                </span>location: "Hunt's Point Market",</p>
<p class="p1"><span class="Apple-converted-space">                </span>category: "air-pollution",</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_smell: "Heavy diesel fumes, burning smell",</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_see: "Black exhaust clouds, trucks idling",</p>
<p class="p1"><span class="Apple-converted-space">                </span>emotional_response: "Worried about my kids breathing this",</p>
<p class="p1"><span class="Apple-converted-space">                </span>observer_name: "Maria R.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>lat: 40.8078,</p>
<p class="p1"><span class="Apple-converted-space">                </span>lng: -73.8820,</p>
<p class="p1"><span class="Apple-converted-space">                </span>timestamp: new Date().toISOString()</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>{</p>
<p class="p1"><span class="Apple-converted-space">                </span>id: 2,</p>
<p class="p1"><span class="Apple-converted-space">                </span>title: "Community Garden Oasis",</p>
<p class="p1"><span class="Apple-converted-space">                </span>location: "Melrose Community Garden",</p>
<p class="p1"><span class="Apple-converted-space">                </span>category: "green-space",</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_see: "Vegetables growing, neighbors talking",</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_hear: "Birds singing, children playing",</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_smell: "Fresh herbs, soil",</p>
<p class="p1"><span class="Apple-converted-space">                </span>emotional_response: "Peaceful, hopeful",</p>
<p class="p1"><span class="Apple-converted-space">                </span>observer_name: "CCNY Fellow - Alex",</p>
<p class="p1"><span class="Apple-converted-space">                </span>lat: 40.8201,</p>
<p class="p1"><span class="Apple-converted-space">                </span>lng: -73.9067,</p>
<p class="p1"><span class="Apple-converted-space">                </span>timestamp: new Date().toISOString()</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Category configurations</p>
<p class="p1"><span class="Apple-converted-space">        </span>const categories = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>'air-pollution': { color: '#dc2626', label: 'Air Pollution' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'noise-pollution': { color: '#7c3aed', label: 'Noise Pollution' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'heat-exposure': { color: '#ea580c', label: 'Heat/Temperature' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'green-space': { color: '#16a34a', label: 'Green Space' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'industrial': { color: '#6b7280', label: 'Industrial Activity' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'community-asset': { color: '#2563eb', label: 'Community Asset' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>'safety-concern': { color: '#ca8a04', label: 'Safety/Health Concern' }</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize map</p>
<p class="p1"><span class="Apple-converted-space">        </span>function initMap() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Check if Leaflet is available</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (typeof L === 'undefined') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error('Leaflet library not loaded');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('map').innerHTML = '&lt;div class="flex items-center justify-center h-full bg-red-50"&gt;&lt;div class="text-center"&gt;&lt;p class="text-red-600"&gt;Map failed to load. Please refresh the page.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Create map centered on South Bronx</p>
<p class="p1"><span class="Apple-converted-space">                </span>map = L.map('map').setView([40.8154, -73.9123], 13);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Add OpenStreetMap tiles</p>
<p class="p1"><span class="Apple-converted-space">                </span>L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>attribution: '© OpenStreetMap contributors',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>errorTileUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5NYXAgVGlsZSBVbmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4='</p>
<p class="p1"><span class="Apple-converted-space">                </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Initialize drawing features</p>
<p class="p1"><span class="Apple-converted-space">                </span>drawnItems = new L.FeatureGroup();</p>
<p class="p1"><span class="Apple-converted-space">                </span>map.addLayer(drawnItems);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Initialize drawing control (but don't add to map yet)</p>
<p class="p1"><span class="Apple-converted-space">                </span>drawControl = new L.Control.Draw({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>edit: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>featureGroup: drawnItems,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>remove: true</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>draw: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>polygon: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>circle: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>rectangle: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>marker: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>circlemarker: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>polyline: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>shapeOptions: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>color: '#16a34a',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>weight: 4,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>opacity: 0.8</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Handle drawing events</p>
<p class="p1"><span class="Apple-converted-space">                </span>map.on(L.Draw.Event.CREATED, function(e) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const layer = e.layer;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>drawnItems.addLayer(layer);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (e.layerType === 'polyline') {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const routeId = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const newRoute = {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>id: routeId,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>name: `Transect Route ${transectRoutes.length + 1}`,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>layer: layer,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>coordinates: layer.getLatLngs(),</p>
<p class="p1"><span class="Apple-converted-space">                            </span>timestamp: new Date().toISOString()</p>
<p class="p1"><span class="Apple-converted-space">                        </span>};</p>
<p class="p1"><span class="Apple-converted-space">                        </span>transectRoutes.push(newRoute);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>updateRoutesList();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Handle map clicks for observations</p>
<p class="p1"><span class="Apple-converted-space">                </span>map.on('click', function(e) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!isDrawingMode) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>selectedLocation = e.latlng;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>openObservationForm();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Add sample observations</p>
<p class="p1"><span class="Apple-converted-space">                </span>observations = [...sampleObservations];</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateObservationMarkers();</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateObservationsList();</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateStats();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Hide loading indicator</p>
<p class="p1"><span class="Apple-converted-space">                </span>const loadingEl = document.getElementById('mapLoading');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (loadingEl) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loadingEl.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log('Map initialized successfully');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error('Error initializing map:', error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('map').innerHTML = '&lt;div class="flex items-center justify-center h-full bg-red-50"&gt;&lt;div class="text-center"&gt;&lt;p class="text-red-600"&gt;Map initialization failed. Please refresh the page.&lt;/p&gt;&lt;p class="text-sm text-gray-600 mt-2"&gt;Error: ' + error.message + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Toggle drawing mode</p>
<p class="p1"><span class="Apple-converted-space">        </span>function toggleDrawingMode() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!map) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Map is not yet initialized. Please wait a moment and try again.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>isDrawingMode = !isDrawingMode;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const btn = document.getElementById('drawingModeBtn');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const text = document.getElementById('drawingModeText');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const instructions = document.getElementById('instructionsPanel');</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (isDrawingMode) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (drawControl) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>map.addControl(drawControl);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>btn.className = 'px-4 py-2 rounded text-sm flex items-center drawing-mode';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text.textContent = 'Drawing Mode';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>instructions.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3 class="font-semibold text-yellow-800 mb-2"&gt;🛣️ Drawing Mode&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;ol class="text-sm text-yellow-700 space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;• Use the drawing tools in the top-left corner&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;• Click the line tool to draw transect routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;• Click "Drawing Mode" again to switch back&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;• Routes will be saved automatically&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/ol&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>instructions.className = 'p-4 border-b bg-yellow-50';</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Update map instructions</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('mapInstructionsTitle').textContent = 'Drawing Routes';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('mapInstructionsList').innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Use drawing tools in top-left corner&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Draw lines to create transect routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Routes save automatically&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Switch back to add observations&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (drawControl) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>map.removeControl(drawControl);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>btn.className = 'px-4 py-2 rounded text-sm flex items-center bg-blue-600 hover:bg-blue-800 text-white';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text.textContent = 'Draw Route';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>instructions.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3 class="font-semibold text-blue-800 mb-2"&gt;📍 Observation Mode&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;ol class="text-sm text-blue-700 space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;🔍 Search for any location worldwide&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;📍 Click anywhere on map to add observations&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;🛣️ Switch to drawing mode for routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;li&gt;📱 Perfect for mobile fieldwork&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/ol&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>instructions.className = 'p-4 border-b bg-blue-50';</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Update map instructions</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('mapInstructionsTitle').textContent = 'Interactive Map';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('mapInstructionsList').innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Drag to pan, scroll to zoom&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Click anywhere to add observation&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Use search to find locations&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;li&gt;• Switch to drawing mode for routes&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error('Error toggling drawing mode:', error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Error switching drawing mode. Please refresh the page if the problem persists.');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Search for location</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function searchLocation() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const query = document.getElementById('searchInput').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!query) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Please enter a location to search for.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!map) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Map is not yet initialized. Please wait a moment and try again.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const response = await fetch(</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`https://nominatim.openstreetmap.org/search?format=json&amp;q=${encodeURIComponent(query)}&amp;limit=1&amp;countrycodes=us`</p>
<p class="p1"><span class="Apple-converted-space">                </span>);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!response.ok) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>throw new Error(`Search failed: ${response.status}`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const results = await response.json();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (results.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const { lat, lon, display_name } = results[0];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>map.setView([parseFloat(lat), parseFloat(lon)], 15);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Optional: Add a temporary marker to show the searched location</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (window.searchMarker) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>map.removeLayer(window.searchMarker);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>window.searchMarker = L.marker([parseFloat(lat), parseFloat(lon)])</p>
<p class="p1"><span class="Apple-converted-space">                        </span>.addTo(map)</p>
<p class="p1"><span class="Apple-converted-space">                        </span>.bindPopup(`&lt;strong&gt;Search Result:&lt;/strong&gt;&lt;br&gt;${display_name}`)</p>
<p class="p1"><span class="Apple-converted-space">                        </span>.openPopup();</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log('Search successful:', display_name);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>alert('Location not found. Try searching for a specific address, neighborhood, or landmark (e.g., "South Bronx, NY" or "Hunt\'s Point, Bronx").');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error('Search error:', error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Search temporarily unavailable. Please check your internet connection and try again.');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Open observation form</p>
<p class="p1"><span class="Apple-converted-space">        </span>function openObservationForm() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (selectedLocation) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('obsLocation').value =<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>`${selectedLocation.lat.toFixed(6)}, ${selectedLocation.lng.toFixed(6)}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('observationModal').classList.add('show');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Close observation form</p>
<p class="p1"><span class="Apple-converted-space">        </span>function closeObservationForm() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('observationModal').classList.remove('show');</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('observationForm').reset();</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectedLocation = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Submit observation form</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('observationForm').addEventListener('submit', function(e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>e.preventDefault();</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!selectedLocation) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('Please click on the map to select a location first.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const formData = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>id: Date.now(),</p>
<p class="p1"><span class="Apple-converted-space">                </span>title: document.getElementById('obsTitle').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>category: document.getElementById('obsCategory').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>observer_name: document.getElementById('obsObserver').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>location: document.getElementById('obsLocation').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_see: document.getElementById('obsSee').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_hear: document.getElementById('obsHear').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_smell: document.getElementById('obsSmell').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>what_you_feel: document.getElementById('obsFeel').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>emotional_response: document.getElementById('obsEmotion').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>description: document.getElementById('obsNotes').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>photo_notes: document.getElementById('obsPhotoNotes').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>lat: selectedLocation.lat,</p>
<p class="p1"><span class="Apple-converted-space">                </span>lng: selectedLocation.lng,</p>
<p class="p1"><span class="Apple-converted-space">                </span>timestamp: new Date().toISOString()</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>observations.push(formData);</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateObservationMarkers();</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateObservationsList();</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">            </span>closeObservationForm();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Update observation markers on map</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateObservationMarkers() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Clear existing markers</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.eachLayer(function(layer) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (layer.options &amp;&amp; layer.options.isObservation) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>map.removeLayer(layer);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Add markers for all observations</p>
<p class="p1"><span class="Apple-converted-space">            </span>observations.forEach(obs =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const category = categories[obs.category] || categories['safety-concern'];</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const marker = L.circleMarker([obs.lat, obs.lng], {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>radius: 10,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fillColor: category.color,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>color: '#fff',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>weight: 3,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>opacity: 1,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fillOpacity: 0.8,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>isObservation: true,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>className: 'observation-marker'</p>
<p class="p1"><span class="Apple-converted-space">                </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Create popup content</p>
<p class="p1"><span class="Apple-converted-space">                </span>const popupContent = `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="p-3 max-w-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h4 class="font-semibold text-base mb-2"&gt;${obs.title}&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm text-gray-600 mb-2"&gt;${obs.observer_name || 'Anonymous'}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm text-gray-600 mb-2"&gt;${obs.location}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${obs.what_you_see ? `&lt;p class="text-sm mb-1"&gt;&lt;strong&gt;👁️ See:&lt;/strong&gt; ${obs.what_you_see}&lt;/p&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${obs.what_you_hear ? `&lt;p class="text-sm mb-1"&gt;&lt;strong&gt;👂 Hear:&lt;/strong&gt; ${obs.what_you_hear}&lt;/p&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${obs.what_you_smell ? `&lt;p class="text-sm mb-1"&gt;&lt;strong&gt;👃 Smell:&lt;/strong&gt; ${obs.what_you_smell}&lt;/p&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${obs.what_you_feel ? `&lt;p class="text-sm mb-1"&gt;&lt;strong&gt;✋ Feel:&lt;/strong&gt; ${obs.what_you_feel}&lt;/p&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${obs.emotional_response ? `&lt;p class="text-sm mb-1"&gt;&lt;strong&gt;💭 Emotional response:&lt;/strong&gt; ${obs.emotional_response}&lt;/p&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>marker.bindPopup(popupContent, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>maxWidth: 300,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>className: 'custom-popup'</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Update observations list in sidebar</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateObservationsList() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const container = document.getElementById('observationsList');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (observations.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>container.innerHTML = '&lt;p class="text-xs text-gray-500 italic"&gt;No observations yet&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const recentObs = observations.slice(-5).reverse();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const html = recentObs.map(obs =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const category = categories[obs.category] || categories['safety-concern'];</p>
<p class="p1"><span class="Apple-converted-space">                </span>return `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div onclick="focusOnObservation(${obs.id})" class="p-3 rounded border cursor-pointer transition-all border-gray-200 hover:border-gray-300 mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex items-start justify-between mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h4 class="font-medium text-sm"&gt;${obs.title}&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="w-4 h-4 rounded" style="background-color: ${category.color}"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-xs text-gray-600 mb-1"&gt;${obs.location}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-xs text-gray-700"&gt;${obs.observer_name || 'Anonymous'}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}).join('');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>container.innerHTML = html;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Update routes list in sidebar</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateRoutesList() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const container = document.getElementById('routesContainer');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (transectRoutes.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>container.innerHTML = '&lt;p class="text-xs text-gray-500 italic"&gt;No routes created yet&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const html = transectRoutes.map(route =&gt; `</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div onclick="focusOnRoute(${route.id})" class="p-2 rounded border border-green-200 bg-green-50 mb-2 cursor-pointer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="font-medium text-sm"&gt;${route.name}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-xs text-gray-600"&gt;${route.coordinates.length} points&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-xs text-gray-500"&gt;${new Date(route.timestamp).toLocaleDateString()}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>`).join('');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>container.innerHTML = html;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Focus on specific observation</p>
<p class="p1"><span class="Apple-converted-space">        </span>function focusOnObservation(obsId) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const obs = observations.find(o =&gt; o.id === obsId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (obs) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>map.setView([obs.lat, obs.lng], 16);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Focus on specific route</p>
<p class="p1"><span class="Apple-converted-space">        </span>function focusOnRoute(routeId) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const route = transectRoutes.find(r =&gt; r.id === routeId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (route &amp;&amp; route.layer) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>map.fitBounds(route.layer.getBounds());</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Update stats</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateStats() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('observationCount').textContent = observations.length;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('routeCount').textContent = transectRoutes.length;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Allow enter key for search</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('searchInput').addEventListener('keypress', function(e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (e.key === 'Enter') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>searchLocation();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Check if Leaflet is loaded and initialize map</p>
<p class="p1"><span class="Apple-converted-space">        </span>function checkLeafletAndInit() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (typeof L !== 'undefined') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>initMap();</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log('Waiting for Leaflet to load...');</p>
<p class="p1"><span class="Apple-converted-space">                </span>setTimeout(checkLeafletAndInit, 100);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize map when page loads</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.addEventListener('DOMContentLoaded', function() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>checkLeafletAndInit();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
